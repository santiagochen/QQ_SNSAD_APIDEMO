package com.santiago.qqsns  {		import flash.display.MovieClip;	import com.tencent.ApiRequest;	import flash.events.Event;	import flash.net.URLLoader;	import fl.controls.TextArea;	import flash.display.Loader;	import flash.events.MouseEvent;	import flash.text.TextField;	import flash.text.TextFormat;	import fl.controls.ComboBox;	import fl.data.DataProvider;	import flash.net.URLRequest;	import flash.external.ExternalInterface;	import fl.controls.Button;	import flash.display.Sprite;			public class Main extends MovieClip {		private var _tracerboard:TextArea;		private var _loader:URLLoader;		static const myAppKey:String = "1Py6cjG4xU2/OYCVPd7LRhw";				private var mytf:TextFormat = new TextFormat("黑体",13,0x666666);				private var _combox:ComboBox;		private var _comboxdp:DataProvider = new DataProvider([											//QQ信息类											{label:"获取个人QQ信息",data:"im/get_baseinfo"},											{label:"获取个人QQ号及邮箱信息",data:"im/get_mailaddress"},											{label:"获取QQ用户头像",data:"im/get_avatarlist"},											{label:"获取用户IM好友列表",data:"im/get_friendlist"},											{label:"获取用户IM好友分组",data:"im/get_friendgroup"},											//活动信息类											{label:"获取活动参与人数",data:"campaign/get_participatedcount"},											{label:"获取参与活动好友数量",data:"campaign/get_participatedfriendscount"},											{label:"获取参与活动好友",data:"campaign/get_participatedfriends"},											{label:"获取参与活动亲密好友数量",data:"campaign/get_closefriendscount"},											{label:"获取参与活动亲密好友",data:"campaign/get_closefriends"},											{label:"获取中奖好友数量",data:"campaign/get_awardfriendscount"},											{label:"获取中奖好友",data:"campaign/get_awardfriends"},											{label:"获取活动中奖用户数量",data:"campaign/get_winnercount"},											//微博信息类											{label:"获取我的微博基本信息",data:"weibo_read/user/info/baseinfo"},											{label:"获取互听好友列表",data:"weibo_read/friends/mutual_list"},											//{label:"获取我的微博听众列表",data:"weibo_read/friends/fanslist_s"},											//{label:"获取我收听的人列表",data:"weibo_read/friends/idollist_s"},											//微博互动类											{label:"收听某个用户",data:"weibo_write/friends/add"},											//用户资料类											//{label:"保存个人资料",data:"profile/save_personalinfo"},											//其他信息类											{label:"获取天气及广告信息",data:"other/get_weatheradinfo"},											]);		public var _textarea:TextArea;							  		private var _userIcon:Loader = new Loader();		private var _partBtn:Button;		private var _curAPIOrder:String = "im/get_baseinfo";		//private var _curAPIParam:Object = new Object();		private var _isParamReady:Boolean;		private var _curAPIWay:String;				private var _subOrder:SubOrder = new SubOrder();		private var _gapline:Sprite = new Sprite;		private var _showResult:ShowResult = new ShowResult();				private var _loading:Loading = new Loading();				public function Main() {			EB.Init(this);			initUI();		}				private function impleOrder():void{			_loader = new URLLoader();			_loader.addEventListener(Event.COMPLETE, onImpleOrder);			_showResult.emptyChild();			this.addChild(_loading);			_loading.x = 250;			_loading.y = 200;						if(_curAPIOrder=="weibo_write/friends/add"||_curAPIOrder=="profile/save_personalinfo"){_curAPIWay = "post";}			else{_curAPIWay = "get";}			_loader.load(new ApiRequest(myAppKey).api(_curAPIOrder,ParamModel._params,_curAPIWay)); //needs HTTP Environments to support;			}				private function onImpleOrder(event:Event):void{ 			var callBack:Object = JSON.parse(event.target.data);			if(callBack.message.toLowerCase()=="success"||callBack.message.toLowerCase().indexOf("success")>0){				_textarea.appendText(callBack.data); 				_showResult.dispatchEvent(new ActionEvent(ActionEvent.START_IMPAPI,[_curAPIOrder,callBack]));				}			else{				_textarea.appendText("failed: "+callBack.message);				}			this.removeChild(_loading);			}				private function onUserIcon(event:Event):void{			this.addChild(_userIcon);			this.removeChild(_loading);			_userIcon.width = _userIcon.height = 40;			_userIcon.x = 500;			_userIcon.y = 10;			}				private function initUI():void{			//get api select			_combox = new ComboBox();			_combox.width = 220;			_combox.height = 23;			_combox.x = 82;			_combox.y = 40;			_combox.dataProvider = _comboxdp;			this.addChild(_combox);			_combox.addEventListener(Event.CHANGE, changeAPI);						//get preparation			this.addChild(equipTxt("QQ社会化广告测试",10,10));			this.addChild(equipTxt("活动类型",10,40));			this.addChild(equipTxt("输出",12,300));						//get textarea;			_textarea = new TextArea();			_textarea.width =  530;			_textarea.height = 64;			_textarea.x = 10;			_textarea.y = 330;			this.addChild(_textarea);						//get button of participation			_partBtn = new Button();			_partBtn.label = "点击开始活动";			this.addChild(_partBtn);			_partBtn.x = 320;			_partBtn.y = 40;			_partBtn.addEventListener(MouseEvent.CLICK, onParticipation);						//subOrder			this.addChild(_subOrder);			_subOrder.dispatchEvent(new ActionEvent(ActionEvent.ORDER_CHANGE,_curAPIOrder));			_subOrder.addEventListener(ActionEvent.PASSED_PARAMS, onReceiveParams);			_subOrder.x = 10;			_subOrder.y = 78;			//showResult			this.addChild(_showResult);			_showResult.x = 10;			_showResult.y = _subOrder.y+44;						//gapline:			_gapline.graphics.lineStyle(1,0x999999,1);			_gapline.graphics.moveTo(10,_showResult.y-10);			_gapline.graphics.lineTo(540,_showResult.y-10);			_gapline.graphics.endFill();			this.addChild(_gapline);			}				private function equipTxt(mes:String,posx:Number=0,posy:Number=0):TextField{			var _txtfield:TextField = new TextField();			_txtfield.width = 200;			_txtfield.text = mes;			_txtfield.x = posx;			_txtfield.y = posy;			_txtfield.setTextFormat(mytf);			return _txtfield;			}				private function changeAPI(event:Event):void{			//_textarea.appendText(event.target.selectedItem.data);			_curAPIOrder = event.target.selectedItem.data;						//change subfilter;			_subOrder.currentView = event.target.selectedItem.data;			//trace(_subOrder.currentView);			}					private function onParticipation(event:MouseEvent):void{			//_textarea.appendText("implementing: "+_curAPIOrder);			_subOrder.dispatchEvent(new ActionEvent(ActionEvent.GRAB_PARAMS,_curAPIOrder));			}					private function onReceiveParams(event:ActionEvent):void{			//_curAPIParam = event.data;			ParamModel._params = event.data;			impleOrder();			//_textarea.appendText(event.data["data"].count)			}			}	}